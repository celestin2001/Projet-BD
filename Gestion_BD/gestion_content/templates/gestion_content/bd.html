{% load static %}


<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BDthèque Africaine - Maison Africaine de la BD</title>
    
    {# Remplacez par le chemin vers votre favicon #}
    <link rel="icon" type="image/png" href="{% static "img/favicon.png" %}"> 
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" integrity="sha512-9usAa10IRO0HhonpyAIVpjrylPvoDwiPUiKdWk5t3PyolY1cOd4DSE0Ga+ri4AuTroPR5aQvXU9xC6qOPnzFeg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/css/aos.css">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">

    <style>
        /* --- DÉFINITION DES VARIABLES ET STYLES DE BASE --- */
        :root {
            --bs-primary: #007bff;
            --darker-blue: #0056b3;
            --light-grey: #f8f9fa;
            --grey-border: #e0e0e0;
            --dark-text: #333;
            --yellow-accent: #ffc107;
            --content-max-width: 1200px;
        }

        body {
            font-family: 'Montserrat', sans-serif;
            background-color: var(--light-grey);
            overflow-x: hidden;
            margin: 0;
            padding: 0;
        }
        
        /* Styles de couleur simplifiés */
        .bg-primary { background-color: var(--bs-primary) !important; }
        .text-primary { color: var(--bs-primary) !important; }
        .btn-primary { 
            background-color: var(--bs-primary) !important; 
            border-color: var(--bs-primary) !important;
        }
        .btn-primary:hover { background-color: var(--darker-blue) !important; border-color: var(--darker-blue) !important; }
        .btn-outline-primary { color: var(--bs-primary); border-color: var(--bs-primary); }
        .btn-outline-primary:hover { background-color: var(--bs-primary); color: white; }

        /* Conteneur principal centré */
        .main-content-wrapper {
            max-width: var(--content-max-width);
            margin-left: auto;
            margin-right: auto;
            padding-left: 15px;
            padding-right: 15px;
            width: 100%;
        }

        /* --- HEADER (NON FIXE) --- */
        /* header.bg-primary {
            position: relative;
            top: auto;
            width: 100%;
            z-index: 1030;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1); 
        }
        
        .header-inner-wrapper {
            max-width: var(--content-max-width);
            margin-left: auto;
            margin-right: auto;
            padding: 0 15px;
        }
        
        .main-nav-bar .nav-link { 
            color: white !important; 
            font-size: 16px; 
            padding: 0.5rem 0.75rem !important;
            font-weight: 600; 
        }
        .main-nav-bar .nav-link:hover { color: var(--yellow-accent) !important; }
        .navbar-brand { 
            color: white !important; 
            font-size: 1.8rem; 
            font-weight: 700; 
            padding: 0.5rem 0;
        } */
        .top-bar { padding: 0.5rem 0; background-color: var(--darker-blue); }

        @media (max-width: 991.98px) { 
            .top-bar { display: none; }
            .navbar-collapse { background-color: var(--bs-primary); padding: 0.5rem 1rem; }
            .main-nav-bar .nav-item { border-bottom: 1px solid rgba(255, 255, 255, 0.1); }
        }

        /* --- STYLES SPÉCIFIQUES BDTHÈQUE --- */
        .filter-card { border-radius: 8px; }
        .bd-card {
            transition: transform 0.3s, box-shadow 0.3s;
            border-radius: 8px;
            overflow: hidden;
            cursor: pointer;
        }
        .bd-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 25px rgba(0, 0, 0, 0.15); 
        }
        .bd-cover-container {
            height: 250px; 
            overflow: hidden;
            background-color: #ddd;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .bd-cover-img {
            width: 100%;
            height: 100%;
            object-fit: cover; 
            transition: transform 0.5s;
        }
        .bd-card:hover .bd-cover-img {
            transform: scale(1.05);
        }
    </style>
</head>
<body> 
    {# Assurez-vous que le chemin d'inclusion du header est correct #}
    {% include "gestion_content/header.html" %} 
    
    <div class="main-content-wrapper my-5">
        
        <div class="row mb-4 mt-5"> 
            <div class="col-12"> 
                <h1 class="text-center display-4 fw-bold mb-3 text-primary">
                    <i class="fas fa-book-open me-3"></i>Notre BDthèque Africaine
                </h1>
                <p class="text-center text-secondary mb-5">
                    Explorez le catalogue complet des bandes dessinées d'auteurs et d'éditeurs africains.
                </p>
            </div>
        </div> 

        <div class="row">
            
            {# --- COLONNE FILTRES (Dynamique) --- #}
            <div class="col-lg-3 mb-4">
                <div class="card shadow-sm border-0 filter-card">
                    <div class="card-body">
                        <h5 class="card-title fw-bold border-bottom pb-2 mb-3 text-primary">
                            <i class="fas fa-filter me-2"></i>Filtrer
                        </h5>

                        {# Le formulaire pointe vers l'URL nommée 'bdtheque' #}
                        <form method="GET" action="{% url 'bdtheque' %}"> 
                            
                            <div class="mb-3">
                                <label for="search_query" class="form-label fw-bold">Recherche rapide</label>
                                <input type="text" name="q" id="search_query" class="form-control" 
                                       placeholder="Titre, ISBN, Mots-clés..." 
                                       value="{{ current_q }}">
                            </div>

                            <div class="mb-3">
                                <label for="filter_auteur" class="form-label fw-bold">Auteur</label>
                                <select name="auteur" id="filter_auteur" class="form-select">
                                    <option value="">Tous les auteurs</option>
                                    {# Boucle et sélection de l'auteur courant #}
                                    {% for auteur in tous_les_auteurs %}
                                    <option value="{{ auteur.pk }}" 
                                        {% if auteur.pk|stringformat:"s" == current_auteur %}selected{% endif %}>
                                        {{ auteur.utilisateur.get_full_name|default:auteur.utilisateur.username }}
                                    </option>
                                    {% endfor %}
                                </select>
                            </div>

                            <div class="mb-3">
                                <label for="filter_editeur" class="form-label fw-bold">Éditeur</label>
                                <select name="editeur" id="filter_editeur" class="form-select">
                                    <option value="">Tous les éditeurs</option>
                                    {# Boucle et sélection de l'éditeur courant #}
                                    {% for editeur in tous_les_editeurs %}
                                    <option value="{{ editeur.pk }}" 
                                        {% if editeur.pk|stringformat:"s" == current_editeur %}selected{% endif %}>
                                        {{ editeur.nom }}
                                    </option>
                                    {% endfor %}
                                </select>
                            </div>
                            
                            <div class="mb-3">
                                <label for="filter_genre" class="form-label fw-bold">Genre</label>
                                <select name="genre" id="filter_genre" class="form-select">
                                    <option value="">Tous les genres</option>
                                    {# Boucle et sélection du genre courant #}
                                    {% for genre in tous_les_genres %}
                                    <option value="{{ genre.slug }}" 
                                        {% if genre.slug == current_genre %}selected{% endif %}>
                                        {{ genre.nom }}
                                    </option>
                                    {% endfor %}
                                </select>
                            </div>

                            <div class="d-grid gap-2">
                                <button type="submit" class="btn btn-primary fw-bold">Appliquer les filtres</button>
                                <a href="{% url 'bdtheque' %}" class="btn btn-outline-secondary btn-sm">Réinitialiser</a>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            {# --- COLONNE RÉSULTATS (Dynamique) --- #}
            <div class="col-lg-9">
                
                <h4 class="mb-4 fw-bold">Résultats trouvés : <span class="text-primary fw-bolder">{{ total_results }} BD</span></h4>

                <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-4 g-4">
                    
                    {# Boucle sur la liste des livres paginés #}
                    {% for livre in livres %} 
                    <div class="col" data-aos="fade-up" ">
                        <div class="card h-100 shadow-sm border-0 bd-card">
                            <a href="" class="text-decoration-none text-dark">
                                <div class="bd-cover-container">
                                    {# Affichage de la couverture ou d'une image par défaut #}
                                    {% if livre.couverture %}
                                    <img src="{{ livre.couverture.url }}" class="card-img-top bd-cover-img" alt="Couverture de {{ livre.titre }}"> 
                                    {% else %}
                                    <img src="https://via.placeholder.com/150x250?text=Pas+de+Couverture" class="card-img-top bd-cover-img" alt="Couverture par défaut"> 
                                    {% endif %}
                                </div>
                                <div class="card-body d-flex flex-column">
                                    <h6 class="card-title fw-bold text-truncate" title="{{ livre.titre }}">{{ livre.titre }}</h6>
                                    
                                    {# Auteur principal #}
                                    <p class="card-text small text-secondary mb-1">
                                        Par: 
                                        {% if livre.auteur_principal %}
                                            <span class="fw-semibold text-dark">{{ livre.auteur_principal.utilisateur.get_full_name|default:livre.auteur_principal.utilisateur.username }}</span>
                                        {% else %}
                                            <span class="fw-semibold text-danger">Auteur inconnu</span>
                                        {% endif %}
                                    </p>
                                    
                                    {# Éditeur #}
                                    <p class="card-text small text-secondary">
                                        Editeur: <span class="fw-semibold text-dark">{{ livre.editeur.nom }}</span>
                                    </p>
                                    
                                    {# Lien de détail #}
                                    <div class="mt-auto pt-2">
                                        <span class="btn btn-sm btn-outline-primary w-100 fw-bold">Voir la fiche</span>
                                    </div>
                                </div>
                            </a>
                        </div>
                    </div>
                    {% empty %}
                    <div class="col-12">
                        <div class="alert alert-warning text-center mt-5" role="alert">
                            <i class="fas fa-exclamation-triangle me-2"></i>**Oups !** Aucun livre trouvé correspondant à vos critères de recherche.
                        </div>
                    </div>
                    {% endfor %}
                    
                </div>
                
                {# --- PAGINATION (Logique de pagination propre aux fonctions de vue) --- #}
                {% if livres.has_other_pages %}
                <div class="d-flex justify-content-center mt-5">
                    <nav aria-label="Page navigation example">
                        <ul class="pagination">
                            
                            {# URL de base sans paramètres de pagination #}
                            {% url 'bdtheque' as bdtheque_url %}
                            
                            {# Bouton Précédent #}
                            <li class="page-item {% if not livres.has_previous %}disabled{% endif %}">
                                <a class="page-link" 
                                   href="{% if livres.has_previous %}
                                           {{ bdtheque_url }}?page={{ livres.previous_page_number }}&{% for key, value in request.GET.items %}{% if key != 'page' %}{{ key }}={{ value }}&{% endif %}{% endfor %}
                                         {% else %}
                                           #
                                         {% endif %}">
                                    Précédent
                                </a>
                            </li>

                            {# Numéros de pages #}
                            {% for i in livres.paginator.page_range %}
                                {% if livres.number == i %}
                                    <li class="page-item active" aria-current="page"><span class="page-link">{{ i }}</span></li>
                                {% elif i > livres.number|add:'-3' and i < livres.number|add:'3' %}
                                    <li class="page-item">
                                        <a class="page-link" 
                                           href="{{ bdtheque_url }}?page={{ i }}&{% for key, value in request.GET.items %}{% if key != 'page' %}{{ key }}={{ value }}&{% endif %}{% endfor %}">
                                           {{ i }}
                                        </a>
                                    </li>
                                {% endif %}
                            {% endfor %}
                            
                            {# Bouton Suivant #}
                            <li class="page-item {% if not livres.has_next %}disabled{% endif %}">
                                <a class="page-link" 
                                   href="{% if livres.has_next %}
                                           {{ bdtheque_url }}?page={{ livres.next_page_number }}&{% for key, value in request.GET.items %}{% if key != 'page' %}{{ key }}={{ value }}&{% endif %}{% endfor %}
                                         {% else %}
                                           #
                                         {% endif %}">
                                    Suivant
                                </a>
                            </li>
                        </ul>
                    </nav>
                </div>
                {% endif %}
                
            </div>
        </div>
    </div>

    {# Assurez-vous que le chemin d'inclusion du footer est correct #}
    {% include "gestion_content/footer.html" %} 
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/js/aos.js"></script>
    <script>
        AOS.init();
    </script>
</body>
</html>